# seL4 可能的优化方向（调研）



### 收集的信息

1. [但是，由于seL4内核在启动后不再动态分配内核内存，而是由用户空间提供内存给内核使用，这也意味着内核内存在不同用户空间程序间是隔离的，带来非常强的完整性和保密性保证，但后果是这种机制使用起来很棘手，很容易误用](https://zhuanlan.zhihu.com/p/144802629)(https://zhuanlan.zhihu.com/p/144802629)。 似乎我们考虑给 seL4 内核增添虚拟内存模块。

2. seL4是一个高度安全的微内核，它是由NICTA（现在是CSIRO）开发的。seL4的内存分配机制是基于slab分配器的，它将内存分配为固定大小的块，这些块可以被多个对象共享。seL4的内存分配器还支持动态内存分配，这使得内核可以在运行时动态地分配和释放内存。内存分配器还支持用户空间内存分配，这使得用户空间程序可以向内核请求内存。用户空间程序可以使用malloc()和free()等标准C库函数来请求和释放内存。

   seL4将系统地址空间划分为两个部分：用户空间和内核空间。用户空间是由用户进程使用的地址空间，而内核空间是由操作系统使用的地址空间。用户进程不能直接访问内核空间，而只能通过系统调用来请求操作系统执行某些任务。这种设计可以防止用户进程破坏操作系统或其他进程。

   seL4的性能非常好，因为它是一个微内核，只包含最基本的功能。此外，seL4使用了一些高级技术来提高性能，例如**基于缓存的IPC和快速路径**。**所以这些方向的优化我们不予考虑**。

3. L4：围绕进程间通信优化而设计的微内核系统

   根据Mach的经验，Liedtke等研究人员开始研发L4系列的微内核系统。L4系列微内核系统的一个突出思路是：进程间通信是微内核的核心功能，需要围绕通信去完成整个系统的设计和实现。L4是当下仍然十分主流的微内核系统，特别是后续衍生出了各种变体和相关的系统。

   [在L4微内核中，内核只保留了基本的功能，包括地址空间、线程、进程间通信等，并且不考虑如兼容性等要求，而是选择针对特定硬件做极致的性能优化。这样做的好处就是内核的代码量非常少，可以把少量的功能尽可能支持好。( sel4 android,终于有人将进程间通信讲明白了_贾小阳的博客-CSDN博客](https://blog.csdn.net/weixin_34803738/article/details/117640024)



### seL4

#### IPC

“Endpoint”: IPC（进程间通信） 的 "亮点"，相当于“邮箱”--所有进程均可向里面投放信息，收取信息，但不能修改里面的信息。用于代替传统操作系统进程间通信的“管道”。[[IPC | seL4 docs](https://docs.sel4.systems/Tutorials/ipc.html)]()



### Virtual Memory

虚拟内存指操作系统提供的逻辑内存。其将物理上离散的内存以及 分布在 Disk（低速） 与 RAM （高速）中的内存映射成逻辑上的**连续内存**。（Wiki）[[Virtual memory - Wikipedia](https://en.wikipedia.org/wiki/Virtual_memory)]()

而据我们调查，seL4 自身似乎并不支持虚拟内存（？）

![](.\pics\Virtual_Memory.png)



### seL4 中的相关名词

#### VSpaces

![](.\pics\VSpace_in_seL4.png)

​		来源：[[t1-03-evancich.pdf (ieee.org)](http://secdev.ieee.org/wp-content/uploads/2020/11/t1-03-evancich.pdf)]

​		但是，这里的“虚拟地址空间”不同于上述所说的虚拟内存。这里指的是对每个线程分配单独的一块“未定义”的内存，被分配了的内存就指派为“虚拟地址空间”，线程只在自己被分配的空间内运行。



#### Virtualization on seL4

​		但是这里指的是虚拟化，指的是将硬件层面的“虚拟化”, 将物理元件抽象化，提供统一的借口，比如虚拟机。[[What is Virtualization? | IBM](https://www.ibm.com/topics/virtualization)]()

​		对于seL4，官方文档说 seL4 自身没有虚拟化，但是提供了两个库函数或者接口（libraries）。与虚拟内存关联不大。[[What is Virtualization? | IBM](https://www.ibm.com/topics/virtualization)]()

